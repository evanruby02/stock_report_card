from core.data import gather_data, format_metrics_for_display, save_entry_to_database
from core.reportcard import grade_reportcard, append_scores_to_df


def main():
    stock = input("Please input a stock ticker (e.g., NVDA): ").strip()

    try:
        df = gather_data(stock)
        if df.empty:
            print(f"No data found for {stock.upper()}.")
            return

        metrics = df.iloc[0].to_dict()
        scores, total_score = grade_reportcard(metrics)
        df_display = format_metrics_for_display(df)
        df_with_scores = append_scores_to_df(df_display, scores)

        print("\nðŸ“Š Metrics with Scores:")
        print(df_with_scores.to_string(index=False))
        print(f"\nðŸ§® Total Quantitative Grade: {total_score}/70")

        # Prompt user to save to database
        save_resp = input(
            "Add this entry to your database? (y/n): ").strip().lower()
        if save_resp == 'y':
            save_entry_to_database(df_with_scores)
            print("Entry saved to database.csv")
        else:
            print("Entry not saved.")

    except Exception as e:
        print(f"An error occurred: {e}")


if __name__ == "__main__":
    main()

